<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>
    <title>Marblizer</title>
    <meta name="description" content="Interactive paper marbling simulation. Create awesome patterns.">
    <meta name="author" content="Nick Walker"/>
    <meta property="og:image" content="https://marblizer.nickwalker.us/media/images/og-banner.jpg"/>
    <link rel="canonical" href="https://marblizer.nickwalker.us/">

    <link rel="shortcut icon" href="/media/images/favicon.png"/>
    <link rel="apple-touch-icon" href="/media/images/apple-touch-icon.png">
    <link rel="mask-icon" href="/media/images/mask.svg" color="#891920">

    <link rel="stylesheet" href="media/css/style.css"/>
    <link rel="stylesheet" href="media/css/help.css">
    <script src="build/build.js"></script>

    <script
            src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.21.0/codemirror.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.21.0/theme/solarized.min.css">


</head>
<body>
<div id="workspace">

</div>

<div class="modal-container" style="display:none;">
    <div id="operations-input" class="marbling-pane center-pane">
        <ul class="button-section">

            <li class="run-button tool" title="Execute">â–¶</li>
            <li class="get-url-button tool" title="Share URL"><img src="media/images/save.svg"></li>
            <li class="close-button tool" title="Close">X</li>
        </ul>
        <div class="input-container"></div>
    </div>
</div>

<div id="marbling-tools" class="marbling-pane">
    <ul class="button-section" id="tools">
        <li class="drop-tool tool" title="Ink drop"><img src="media/images/drop.svg"/></li>
        <li class="spatter-tool tool" title="Spatter"><img src="media/images/spatter.svg"/></li>
        <li class="tine-tool tool" title="Tine line"><img src="media/images/tine-line.svg"/></li>
        <li class="wavy-tine-tool tool" title="Wavy "><img src="media/images/wavy-tine.svg"></li>
        <li class="circular-tine-tool tool" title="Circular tine-line"><img src="media/images/circular-tine.svg"></li>
        <li class="vortex-tool tool" title="Vortex"><img src="media/images/vortex.svg"/></li>
    </ul>
    <hr class="tools-divider">
    <ul class="button-section options" id="options">
        <li class="show-script-editor tool" title="Script editor"><img src="media/images/script.svg"></li>
        <li class="save-image tool" title="Save image"><img src="media/images/save.svg"></li>
        <li class="show-field tool" title="Show tool force field"><img src="media/images/field.svg"></li>
        <li class="reset" title="Reset canvas"><img src="media/images/reset.svg"></li>
        <li class="help" title="Help"><img src="media/images/help.svg"></li>
        <li class="show-keyboard-shortcuts" title="Show keyboard shortcuts"><img src="media/images/shortcuts.svg"></li>
    </ul>
    <hr class="tools-divider">
    <div id="colors">
        <div id="color-inputs">
            <input type="color" class="color-picker foreground" value="#891920" title="Foreground color">
            <input type="color" class="color-picker background" value="#DCD2D2" title="Background color">
        </div>
        <ul class="button-section" id="recent-colors">
            <li class="swatch-0"></li>
            <li class="swatch-1"></li>
            <li class="swatch-2"></li>
            <li class="swatch-3"></li>
            <li class="swatch-4"></li>
        </ul>
    </div>
    <div id="logo"><img src="media/images/logo.svg"/></div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.21.0/codemirror.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.21.0/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.3.6/svg.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

<script>
    let renderer = null;
    addEventListener('DOMContentLoaded', function () {
        let marblingWorkspace = document.getElementById("workspace");
        let toolsPane = document.getElementById("tools");
        let optionsPane = document.getElementById("options");
        let colorsPane = document.getElementById("colors");
        let operationsInput = document.getElementById("operations-input");
        let ui = new MarblingUI(marblingWorkspace, toolsPane, optionsPane, colorsPane, operationsInput);
        renderer = new InteractiveCurveRenderer(marblingWorkspace);
        ui.delegate = renderer;
        renderer.setSize(window.innerWidth, window.innerHeight);
        ui.size = new Vec2(window.innerWidth, window.innerHeight);

        window.onresize = function (event) {
            renderer.setSize(window.innerWidth, window.innerHeight);
            ui.size = new Vec2(window.innerWidth, window.innerHeight);
        };

        const parameter = getParameterByName("p");
        if (parameter != null && confirm("Execute passed in program?")) {
            const decompressed = LZString.decompressFromEncodedURIComponent(parameter);
            const program = new UserProgram(decompressed);
            renderer.applyOperations(program.execute(new Vec2(window.innerWidth, window.innerHeight)));
        }

        const palette = [];
        for (let i = 0; i < colorSets.length; i++) {
            palette.push([]);
            for (let j = 0; j < colorSets[0].length; j++) {
                palette[i].push(colorSets[i][j].toHexString());
            }
        }
        $("input[type='color'].foreground").spectrum({
            showPalette: true,
            preferredFormat: "hex",
            showSelectionPalette: true,
            maxSelectionSize: 5,
            palette: palette,
            replacerClassName: "foreground-spectrum"
        });
        $("input[type='color'].background").spectrum({
            showPalette: true,
            preferredFormat: "hex",
            showSelectionPalette: true,
            maxSelectionSize: 5,
            palette: palette,
            replacerClassName: "background-spectrum"
        });

        const event = new CustomEvent("colorPickersInstalled");
        document.dispatchEvent(event);

    });
</script>


</body>
</html>